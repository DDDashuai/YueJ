import{u as E,r as c,a as z,y as G,c as h,d as n,w as o,e as H,f as m,h as l,o as V,b as O,i as w,F as $,A as j,n as J,t as K,G as P,H as Q}from"./index-9Ol6iB9x.js";import{u as W}from"./medicine-cKG_gKfd.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"medicine-reminder"},Z={style:{margin:"16px"}},ee={__name:"MedicineReminder",setup(ae){const x=H(),p=E(),_=W(),g=c(0),i=c(!1),y=c(!1),f=c(!1),b=c([]),t=z({medicineName:"",dosage:"",frequency:"",notes:""}),I=()=>{x.back()},R=s=>new Date(s).toLocaleString(),T=async s=>{var e;try{if(!((e=p.user)!=null&&e.userId)){m("请先登录"),x.push("/login");return}const r={medicineName:t.medicineName,dosage:t.dosage,frequency:t.frequency,notes:t.notes,nextRemindTime:new Date().toISOString()};console.log("提交用药提醒:",r),await _.addReminder(r)?(m("添加成功"),C(),g.value=1,await v()):m("添加失败")}catch(r){m(r.message||"添加失败")}},C=()=>{t.medicineName="",t.dosage="",t.frequency="",t.notes=""},v=async()=>{var s;i.value=!0,y.value=!1,b.value=[];try{(s=p.user)!=null&&s.userId&&(await _.getReminders(p.user.userId),b.value=_.reminders)}catch{m("获取数据失败")}finally{i.value=!1,y.value=!0}},k=async()=>{f.value=!0;try{await v()}finally{f.value=!1}},L=async()=>{i.value||await v()};G(async()=>{await v()});const U=async s=>{try{P("删除成功"),k()}catch{Q("删除失败")}};return(s,e)=>{const r=l("van-nav-bar"),u=l("van-field"),q=l("van-cell-group"),N=l("van-button"),D=l("van-form"),S=l("van-tab"),B=l("van-tag"),d=l("van-cell"),F=l("van-list"),M=l("van-pull-refresh"),A=l("van-tabs");return V(),h("div",Y,[n(r,{title:"用药助手","left-arrow":"",onClickLeft:I}),n(A,{active:g.value,"onUpdate:active":e[6]||(e[6]=a=>g.value=a),sticky:"",style:{"margin-top":"20px"}},{default:o(()=>[n(S,{title:"添加提醒",style:{"margin-top":"20px"}},{default:o(()=>[n(D,{onSubmit:T},{default:o(()=>[n(q,{inset:""},{default:o(()=>[n(u,{modelValue:t.medicineName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.medicineName=a),name:"medicineName",label:"药品名称",placeholder:"请输入药品名称",rules:[{required:!0,message:"请填写药品名称"}]},null,8,["modelValue"]),n(u,{modelValue:t.dosage,"onUpdate:modelValue":e[1]||(e[1]=a=>t.dosage=a),name:"dosage",label:"用药剂量",placeholder:"请输入用药剂量",rules:[{required:!0,message:"请填写用药剂量"}]},null,8,["modelValue"]),n(u,{modelValue:t.frequency,"onUpdate:modelValue":e[2]||(e[2]=a=>t.frequency=a),name:"frequency",label:"服药频率",placeholder:"如：每天三次",rules:[{required:!0,message:"请填写服药频率"}]},null,8,["modelValue"]),n(u,{modelValue:t.notes,"onUpdate:modelValue":e[3]||(e[3]=a=>t.notes=a),name:"notes",label:"备注",type:"textarea",placeholder:"请输入备注信息",rows:"2"},null,8,["modelValue"])]),_:1}),O("div",Z,[n(N,{round:"",block:"",type:"primary","native-type":"submit"},{default:o(()=>e[7]||(e[7]=[w(" 添加提醒 ")])),_:1})])]),_:1})]),_:1}),n(S,{title:"提醒列表"},{default:o(()=>[n(M,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),onRefresh:k},{default:o(()=>[n(F,{loading:i.value,"onUpdate:loading":e[4]||(e[4]=a=>i.value=a),finished:y.value,"finished-text":"没有更多了",onLoad:L},{default:o(()=>[(V(!0),h($,null,j(b.value,a=>(V(),J(q,{key:a.reminderId,inset:"",style:{"margin-top":"20px"}},{default:o(()=>[n(d,{title:a.medicineName,label:a.frequency},{"right-icon":o(()=>[n(B,{type:a.status==="ACTIVE"?"success":"warning"},{default:o(()=>[w(K(a.status==="ACTIVE"?"进行中":"已完成"),1)]),_:2},1032,["type"])]),_:2},1032,["title","label"]),n(d,{title:"用药剂量",value:a.dosage},null,8,["value"]),n(d,{title:"下次提醒",value:R(a.nextRemindTime)},null,8,["value"]),n(d,{title:"备注",label:a.notes},null,8,["label"]),n(d,null,{"right-icon":o(()=>[n(N,{size:"small",type:"danger",onClick:ne=>U(a.reminderId)},{default:o(()=>e[8]||(e[8]=[w(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["active"])])}}},se=X(ee,[["__scopeId","data-v-4e85e9be"]]);export{se as default};
