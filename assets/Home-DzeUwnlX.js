import{u as G,r as u,y as $,c as n,b as e,d as r,z as _,t as i,w as v,F as p,A as H,n as q,q as O,e as U,h as b,o,i as y,B as j,f as J}from"./index-Yn9dULvO.js";import{u as K}from"./medicine-DlH4mGjq.js";import{u as Q}from"./health-D2ZD7_Ki.js";import{u as W}from"./chat-C7lii3bb.js";import{f as X,a as Y}from"./date-mP0Ysl1n.js";import{A as Z}from"./AvatarLetter-Cc31NaFF.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"home-page"},te={class:"header"},ae={class:"user-info"},oe={class:"user-detail"},ne={class:"username"},le={class:"health-overview card"},ie={class:"card-header"},re={class:"health-grid"},ce={class:"item-label"},ue={class:"item-unit"},de={class:"medicine-reminders card"},me={class:"card-header"},he={class:"reminder-list"},_e={key:0,class:"empty-tip"},ve={class:"reminder-time"},pe={class:"reminder-content"},ye={class:"medicine-reminders card"},fe={class:"card-header"},ke={class:"chat-list"},ge=["onClick"],Ce={class:"chat-icon"},we={class:"chat-info"},He={class:"chat-time"},be={class:"chat-preview"},De={key:0,class:"empty-state"},Ie={__name:"Home",setup(Re){const d=U(),l=G(),f=K(),k=Q(),m=W(),g=u([{type:"bloodPressure",label:"血压",value:null,unit:"mmHg"},{type:"heartRate",label:"心率",value:null,unit:"次/分"},{type:"bloodSugar",label:"血糖",value:null,unit:"mmol/L"},{type:"weight",label:"体重",value:null,unit:"kg"}]),C=u([]),z=u([]),h=u(!1),w=u([]);$(async()=>{var a;(a=l.user)!=null&&a.userId&&await Promise.all([T(),D(),x(),A()])});const T=async()=>{await k.getLatestHealth(l.user.userId)&&k.healthData&&B(k.healthData)},D=async()=>{await f.getActiveReminders(l.user.userId)&&(C.value=f.activeReminders)},x=async()=>{await m.getChatHistory(l.user.userId)&&(z.value=m.chatHistory)},A=async()=>{var a;if((a=l.user)!=null&&a.userId){h.value=!0;try{const s=await m.getChatGroups(l.user.userId);w.value=s.slice(0,3)}catch(s){console.error("获取最近会诊记录失败:",s)}finally{h.value=!1}}},B=a=>{g.value=g.value.map(s=>{const c=a[s.type];return{...s,value:c||"--"}})},L=async a=>{await f.updateReminder(a,{status:"COMPLETED"})&&await D()},N=()=>d.push("/health"),M=()=>d.push("/medicine"),V=async a=>{try{await m.loadGroupChat(l.user.userId,a.chat_group_id),d.push("/chat")}catch{J("加载聊天记录失败")}},E=()=>{d.push("/chat")};return(a,s)=>{var R,S;const c=b("van-button"),P=b("van-skeleton"),I=b("van-icon");return o(),n("div",se,[e("div",te,[e("div",ae,[r(Z,{username:((R=_(l).user)==null?void 0:R.username)||"?",size:60},null,8,["username"]),e("div",oe,[e("h3",ne,i(((S=_(l).user)==null?void 0:S.username)||"未登录"),1),s[0]||(s[0]=e("p",{class:"welcome"},"欢迎使用健康管理平台",-1))])])]),e("div",le,[e("div",ie,[s[2]||(s[2]=e("h3",null,"今日健康概览",-1)),r(c,{size:"small",type:"primary",plain:"",onClick:N},{default:v(()=>s[1]||(s[1]=[y(" 查看详情 ")])),_:1})]),e("div",re,[(o(!0),n(p,null,H(g.value,t=>(o(),n("div",{class:"health-item",key:t.type},[e("span",ce,i(t.label),1),e("span",{class:j(["item-value",t.status])},i(t.value||"--"),3),e("span",ue,i(t.unit),1)]))),128))])]),e("div",de,[e("div",me,[s[4]||(s[4]=e("h3",null,"用药提醒",-1)),r(c,{size:"small",type:"primary",plain:"",onClick:M},{default:v(()=>s[3]||(s[3]=[y(" 全部提醒 ")])),_:1})]),e("div",he,[C.value.length===0?(o(),n("div",_e," 暂无用药提醒 ")):(o(!0),n(p,{key:1},H(C.value,t=>(o(),n("div",{key:t.reminderId,class:"reminder-item"},[e("div",ve,i(_(X)(t.nextRemindTime)),1),e("div",pe,[e("h4",null,i(t.medicineName),1),e("p",null,i(t.dosage),1)]),r(c,{size:"small",type:"primary",onClick:F=>L(t.reminderId)},{default:v(()=>s[5]||(s[5]=[y(" 已服用 ")])),_:2},1032,["onClick"])]))),128))])]),e("div",ye,[e("div",fe,[s[7]||(s[7]=e("span",{class:"title"},"最近会诊",-1)),r(c,{size:"small",plain:"",round:"",onClick:E},{default:v(()=>s[6]||(s[6]=[y(" 开始问诊 ")])),_:1})]),e("div",ke,[h.value?(o(),q(P,{key:0,title:"",row:2,loading:h.value},null,8,["loading"])):(o(),n(p,{key:1},[(o(!0),n(p,null,H(w.value,t=>(o(),n("div",{key:t.chat_group_id,class:"chat-item",onClick:F=>V(t)},[e("div",Ce,[r(I,{name:t.conversationType==="western"?"cluster-o":"flower-o",size:"24"},null,8,["name"])]),e("div",we,[e("div",He,i(_(Y)(t.created_at)),1),e("div",be,i(t.last_message),1)]),r(I,{name:"arrow",class:"arrow-icon"})],8,ge))),128)),w.value.length===0?(o(),n("div",De," 暂无会诊记录 ")):O("",!0)],64))])])])}}},Ne=ee(Ie,[["__scopeId","data-v-8173003c"]]);export{Ne as default};
