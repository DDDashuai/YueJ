import{u as ae}from"./health-DGA4tfID.js";import{a as L}from"./date-mP0Ysl1n.js";import{u as oe,r as _,a as se,y as le,f as i,c as m,d as o,b as s,w as l,n as F,F as C,A as x,e as ne,h as n,o as d,B as re,i as u,t as c,q as ie,z}from"./index-Biv-8KlJ.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as de}from"./function-call-CFEwnpY2.js";const ce={class:"health-page"},pe={class:"data-overview card"},ve={class:"data-item"},me={class:"unit"},_e={class:"data-label"},he={key:0,class:"data-trend"},fe={class:"data-input card"},ye={class:"card-header"},ge={style:{margin:"16px"}},be={class:"data-history card"},we={class:"card-header"},ke={key:1,class:"history-list"},Ve={class:"history-date"},De={class:"history-content"},Ce={class:"history-data"},xe={class:"value"},He={class:"filter-container"},Pe={class:"filter-content"},Re={class:"filter-actions"},Se={__name:"Health",setup(Ie){const p=ae(),h=oe(),H=ne(),k=_([{type:"bloodPressure",label:"血压",value:null,unit:"mmHg",status:""},{type:"heartRate",label:"心率",value:null,unit:"次/分",status:""},{type:"bloodSugar",label:"血糖",value:null,unit:"mmol/L",status:""},{type:"weight",label:"体重",value:null,unit:"kg",status:""}]),f=_(new Date),r=se({bloodPressure:"",heartRate:"",bloodSugar:"",weight:""}),V=_([]),y=_(!1),g=_(!1),D=_([]),B=[{label:"血压",value:"bloodPressure"},{label:"心率",value:"heartRate"},{label:"血糖",value:"bloodSugar"},{label:"体重",value:"weight"}];le(async()=>{var a;(a=h.user)!=null&&a.userId&&await P()});const P=async()=>{var a;if(!((a=h.user)!=null&&a.userId)){i("请先登录"),H.push("/login");return}try{await Promise.all([T(),R()])}catch{i("数据加载失败")}},T=async()=>{await p.getLatestHealth(h.user.userId)&&p.healthData&&N(p.healthData)},R=async()=>{await p.getHealthHistory(h.user.userId)&&(V.value=p.healthHistory)},N=a=>{a&&(console.log("更新健康数据显示:",a),k.value=k.value.map(e=>{const b=a[e.type];return{...e,value:b||"--"}}))},$=async()=>{var a;if(!((a=h.user)!=null&&a.userId)){i("请先登录"),H.push("/login");return}try{const e={...r,date:f.value};await p.addHealthData(e)?(i("保存成功"),await P(),q()):i("保存失败")}catch(e){i(e.message||"保存失败")}},q=()=>{Object.keys(r).forEach(a=>r[a]="")},E=()=>{y.value=!0},M=a=>{f.value=a,y.value=!1},j=()=>{g.value=!0},A=async()=>{g.value=!1},O=()=>{D.value=[]},G=a=>{if(!a){i("记录ID不能为空");return}de({title:"确认删除",message:"确定要删除这条记录吗？",showCancelButton:!0}).then(async()=>{try{await p.deleteHealthRecord(a)?(i("删除成功"),await R()):i("删除失败")}catch{i("删除失败")}})},J=a=>{i({bloodPressure:"收缩压/舒张压，如：120/80",heartRate:"正常范围：60-100次/分",bloodSugar:"空腹正常范围：3.9-6.1mmol/L",weight:"请输入实际体重"}[a])};return(a,e)=>{const b=n("van-nav-bar"),K=n("van-icon"),Q=n("van-col"),W=n("van-row"),v=n("van-button"),w=n("van-field"),S=n("van-cell-group"),X=n("van-form"),Y=n("van-empty"),Z=n("van-datetime-picker"),I=n("van-popup"),U=n("van-cell"),ee=n("van-checkbox"),te=n("van-checkbox-group");return d(),m("div",ce,[o(b,{title:"健康数据"}),s("div",pe,[o(W,null,{default:l(()=>[(d(!0),m(C,null,x(k.value,t=>(d(),F(Q,{span:"12",key:t.type},{default:l(()=>[s("div",ve,[s("div",{class:re(["data-value",t.status])},[u(c(t.value||"--")+" ",1),s("span",me,c(t.unit),1)],2),s("div",_e,c(t.label),1),t.trend?(d(),m("div",he,[o(K,{name:t.trend>0?"arrow-up":"arrow-down",color:t.trend>0?"#ee0a24":"#07c160"},null,8,["name","color"]),u(" "+c(Math.abs(t.trend))+"% ",1)])):ie("",!0)])]),_:2},1024))),128))]),_:1})]),s("div",fe,[s("div",ye,[e[11]||(e[11]=s("h3",null,"数据录入",-1)),o(v,{size:"small",type:"primary",onClick:E},{default:l(()=>[u(c(z(L)(f.value)),1)]),_:1})]),o(X,{onSubmit:$},{default:l(()=>[o(S,{inset:""},{default:l(()=>[o(w,{modelValue:r.bloodPressure,"onUpdate:modelValue":e[0]||(e[0]=t=>r.bloodPressure=t),label:"血压",placeholder:"请输入血压值","right-icon":"question-o",onClickRightIcon:e[1]||(e[1]=t=>J("bloodPressure"))},{"right-icon":l(()=>e[12]||(e[12]=[s("span",{class:"unit-text"},"mmHg",-1)])),_:1},8,["modelValue"]),o(w,{modelValue:r.heartRate,"onUpdate:modelValue":e[2]||(e[2]=t=>r.heartRate=t),type:"digit",label:"心率",placeholder:"请输入心率值"},{"right-icon":l(()=>e[13]||(e[13]=[s("span",{class:"unit-text"},"次/分",-1)])),_:1},8,["modelValue"]),o(w,{modelValue:r.bloodSugar,"onUpdate:modelValue":e[3]||(e[3]=t=>r.bloodSugar=t),type:"digit",label:"血糖",placeholder:"请输入血糖值"},{"right-icon":l(()=>e[14]||(e[14]=[s("span",{class:"unit-text"},"mmol/L",-1)])),_:1},8,["modelValue"]),o(w,{modelValue:r.weight,"onUpdate:modelValue":e[4]||(e[4]=t=>r.weight=t),type:"digit",label:"体重",placeholder:"请输入体重"},{"right-icon":l(()=>e[15]||(e[15]=[s("span",{class:"unit-text"},"kg",-1)])),_:1},8,["modelValue"])]),_:1}),s("div",ge,[o(v,{round:"",block:"",type:"primary","native-type":"submit"},{default:l(()=>e[16]||(e[16]=[u(" 保存记录 ")])),_:1})])]),_:1})]),s("div",be,[s("div",we,[e[18]||(e[18]=s("h3",null,"历史记录",-1)),o(v,{size:"small",plain:"",type:"primary",onClick:j},{default:l(()=>e[17]||(e[17]=[u(" 筛选 ")])),_:1})]),V.value.length===0?(d(),F(Y,{key:0,description:"暂无记录"})):(d(),m("div",ke,[(d(!0),m(C,null,x(V.value,t=>(d(),m("div",{key:t.healthRecordId,class:"history-item"},[s("div",Ve,c(z(L)(t.updateTime)),1),s("div",De,[s("div",Ce,[e[19]||(e[19]=s("span",{class:"label"},"血压",-1)),s("span",xe,c(t.bloodPressure)+"mmHg",1)])]),o(v,{size:"small",type:"danger",plain:"",onClick:Ue=>G(t.healthRecordId)},{default:l(()=>e[20]||(e[20]=[u(" 删除 ")])),_:2},1032,["onClick"])]))),128))]))]),o(I,{show:y.value,"onUpdate:show":e[7]||(e[7]=t=>y.value=t),position:"bottom"},{default:l(()=>[o(Z,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),type:"date",title:"选择日期","max-date":new Date,onConfirm:M,onCancel:e[6]||(e[6]=t=>y.value=!1)},null,8,["modelValue","max-date"])]),_:1},8,["show"]),o(I,{show:g.value,"onUpdate:show":e[10]||(e[10]=t=>g.value=t),position:"right",style:{width:"80%",height:"100%"}},{default:l(()=>[s("div",He,[o(b,{title:"筛选条件","left-arrow":"",onClickLeft:e[8]||(e[8]=t=>g.value=!1)}),s("div",Pe,[o(S,null,{default:l(()=>[o(U,{title:"时间范围"},{"right-icon":l(()=>[o(v,{size:"small",onClick:a.showDateRangePicker},{default:l(()=>e[21]||(e[21]=[u(" 选择时间 ")])),_:1},8,["onClick"])]),_:1}),o(U,{title:"数据类型"},{"right-icon":l(()=>[o(te,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=t=>D.value=t)},{default:l(()=>[(d(),m(C,null,x(B,t=>o(ee,{key:t.value,name:t.value},{default:l(()=>[u(c(t.label),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s("div",Re,[o(v,{block:"",type:"primary",onClick:A},{default:l(()=>e[22]||(e[22]=[u(" 应用筛选 ")])),_:1}),o(v,{block:"",plain:"",onClick:O},{default:l(()=>e[23]||(e[23]=[u(" 重置 ")])),_:1})])])])]),_:1},8,["show"])])}}},Ne=ue(Se,[["__scopeId","data-v-5c93dc6c"]]);export{Ne as default};
