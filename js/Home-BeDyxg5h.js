import{u as $,r as u,o as F,a as b,b as o,Q as n,R as e,V as r,a1 as _,a2 as i,w as v,W as p,a3 as y,a4 as H,a5 as O,c as Q,a0 as U,s as W}from"./vendor-BBsPRJ_E.js";import{u as j}from"./index-CfC59-8V.js";import{u as q}from"./medicine-BsLF5ycu.js";import{u as J}from"./health-DWWe7pBk.js";import{u as K}from"./chat-Cqxs3pXi.js";import{f as X,a as Y}from"./date-mP0Ysl1n.js";import{A as Z}from"./AvatarLetter-UhON8Et9.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-DXsv3KKR.js";const se={class:"home-page"},te={class:"header"},ae={class:"user-info"},oe={class:"user-detail"},ne={class:"username"},le={class:"health-overview card"},ie={class:"card-header"},re={class:"health-grid"},ce={class:"item-label"},ue={class:"item-unit"},de={class:"medicine-reminders card"},me={class:"card-header"},he={class:"reminder-list"},_e={key:0,class:"empty-tip"},ve={class:"reminder-time"},pe={class:"reminder-content"},ye={class:"medicine-reminders card"},fe={class:"card-header"},ke={class:"chat-list"},ge=["onClick"],Ce={class:"chat-icon"},we={class:"chat-info"},be={class:"chat-time"},He={class:"chat-preview"},De={key:0,class:"empty-state"},Re={__name:"Home",setup(Ie){const d=$(),l=j(),f=q(),k=J(),m=K(),g=u([{type:"bloodPressure",label:"血压",value:null,unit:"mmHg"},{type:"heartRate",label:"心率",value:null,unit:"次/分"},{type:"bloodSugar",label:"血糖",value:null,unit:"mmol/L"},{type:"weight",label:"体重",value:null,unit:"kg"}]),C=u([]),T=u([]),h=u(!1),w=u([]);F(async()=>{var a;(a=l.user)!=null&&a.userId&&await Promise.all([z(),D(),x(),L()])});const z=async()=>{await k.getLatestHealth(l.user.userId)&&k.healthData&&N(k.healthData)},D=async()=>{await f.getActiveReminders(l.user.userId)&&(C.value=f.activeReminders)},x=async()=>{await m.getChatHistory(l.user.userId)&&(T.value=m.chatHistory)},L=async()=>{var a;if((a=l.user)!=null&&a.userId){h.value=!0;try{const s=await m.getChatGroups(l.user.userId);w.value=s.slice(0,3)}catch(s){console.error("获取最近会诊记录失败:",s)}finally{h.value=!1}}},N=a=>{g.value=g.value.map(s=>{const c=a[s.type];return{...s,value:c||"--"}})},V=async a=>{await f.updateReminder(a,{status:"COMPLETED"})&&await D()},A=()=>d.push("/health"),B=()=>d.push("/medicine"),M=async a=>{try{await m.loadGroupChat(l.user.userId,a.chat_group_id),d.push("/chat")}catch{W("加载聊天记录失败")}},E=()=>{d.push("/chat")};return(a,s)=>{var I,S;const c=b("van-button"),P=b("van-skeleton"),R=b("van-icon");return o(),n("div",se,[e("div",te,[e("div",ae,[r(Z,{username:((I=_(l).user)==null?void 0:I.username)||"?",size:60},null,8,["username"]),e("div",oe,[e("h3",ne,i(((S=_(l).user)==null?void 0:S.username)||"未登录"),1),s[0]||(s[0]=e("p",{class:"welcome"},"欢迎使用健康管理平台",-1))])])]),e("div",le,[e("div",ie,[s[2]||(s[2]=e("h3",null,"今日健康概览",-1)),r(c,{size:"small",type:"primary",plain:"",onClick:A},{default:v(()=>s[1]||(s[1]=[p(" 查看详情 ")])),_:1})]),e("div",re,[(o(!0),n(y,null,H(g.value,t=>(o(),n("div",{class:"health-item",key:t.type},[e("span",ce,i(t.label),1),e("span",{class:O(["item-value",t.status])},i(t.value||"--"),3),e("span",ue,i(t.unit),1)]))),128))])]),e("div",de,[e("div",me,[s[4]||(s[4]=e("h3",null,"用药提醒",-1)),r(c,{size:"small",type:"primary",plain:"",onClick:B},{default:v(()=>s[3]||(s[3]=[p(" 全部提醒 ")])),_:1})]),e("div",he,[C.value.length===0?(o(),n("div",_e," 暂无用药提醒 ")):(o(!0),n(y,{key:1},H(C.value,t=>(o(),n("div",{key:t.reminderId,class:"reminder-item"},[e("div",ve,i(_(X)(t.nextRemindTime)),1),e("div",pe,[e("h4",null,i(t.medicineName),1),e("p",null,i(t.dosage),1)]),r(c,{size:"small",type:"primary",onClick:G=>V(t.reminderId)},{default:v(()=>s[5]||(s[5]=[p(" 已服用 ")])),_:2},1032,["onClick"])]))),128))])]),e("div",ye,[e("div",fe,[s[7]||(s[7]=e("span",{class:"title"},"最近会诊",-1)),r(c,{size:"small",plain:"",round:"",onClick:E},{default:v(()=>s[6]||(s[6]=[p(" 开始问诊 ")])),_:1})]),e("div",ke,[h.value?(o(),Q(P,{key:0,title:"",row:2,loading:h.value},null,8,["loading"])):(o(),n(y,{key:1},[(o(!0),n(y,null,H(w.value,t=>(o(),n("div",{key:t.chat_group_id,class:"chat-item",onClick:G=>M(t)},[e("div",Ce,[r(R,{name:t.conversationType==="western"?"cluster-o":"flower-o",size:"24"},null,8,["name"])]),e("div",we,[e("div",be,i(_(Y)(t.created_at)),1),e("div",He,i(t.last_message),1)]),r(R,{name:"arrow",class:"arrow-icon"})],8,ge))),128)),w.value.length===0?(o(),n("div",De," 暂无会诊记录 ")):U("",!0)],64))])])])}}},Me=ee(Re,[["__scopeId","data-v-681cb16d"]]);export{Me as default};
